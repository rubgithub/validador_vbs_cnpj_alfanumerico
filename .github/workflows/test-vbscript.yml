name: Test VBScript

on: [push, pull_request]

jobs:
  test-vbs:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run VBScript against CSV and fail if any invalids found
        shell: pwsh
        run: |
          # Run validator, capture output to file and print it
          & cscript //Nologo .\teste_cnpjs_validos.vbs 2>&1 | Tee-Object -FilePath results.txt
          Write-Host "--- Validator output ---"
          Get-Content results.txt | ForEach-Object { Write-Host $_ }
          # Fail if script returned non-zero exit code
          if ($LASTEXITCODE -ne 0) { Write-Error "Validation failed: invalid CNPJs found. See results.txt for details"; exit 1 }
      - name: Upload results.txt artifact (on failure)
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: validation-results
          path: results.txt
